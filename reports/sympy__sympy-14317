[{"repo": "sympy/sympy", "instance_id": "sympy__sympy-14317", "base_commit": "fb536869fb7aa28b2695ad7a3b70949926b291c4", "patch": "diff --git a/sympy/printing/latex.py b/sympy/printing/latex.py\n--- a/sympy/printing/latex.py\n+++ b/sympy/printing/latex.py\n@@ -1813,7 +1813,50 @@ def _print_PolynomialRingBase(self, expr):\n \n     def _print_Poly(self, poly):\n         cls = poly.__class__.__name__\n-        expr = self._print(poly.as_expr())\n+        terms = []\n+        for monom, coeff in poly.terms():\n+            s_monom = ''\n+            for i, exp in enumerate(monom):\n+                if exp > 0:\n+                    if exp == 1:\n+                        s_monom += self._print(poly.gens[i])\n+                    else:\n+                        s_monom += self._print(pow(poly.gens[i], exp))\n+\n+            if coeff.is_Add:\n+                if s_monom:\n+                    s_coeff = r\"\\left(%s\\right)\" % self._print(coeff)\n+                else:\n+                    s_coeff = self._print(coeff)\n+            else:\n+                if s_monom:\n+                    if coeff is S.One:\n+                        terms.extend(['+', s_monom])\n+                        continue\n+\n+                    if coeff is S.NegativeOne:\n+                        terms.extend(['-', s_monom])\n+                        continue\n+\n+                s_coeff = self._print(coeff)\n+\n+            if not s_monom:\n+                s_term = s_coeff\n+            else:\n+                s_term = s_coeff + \" \" + s_monom\n+\n+            if s_term.startswith('-'):\n+                terms.extend(['-', s_term[1:]])\n+            else:\n+                terms.extend(['+', s_term])\n+\n+        if terms[0] in ['-', '+']:\n+            modifier = terms.pop(0)\n+\n+            if modifier == '-':\n+                terms[0] = '-' + terms[0]\n+\n+        expr = ' '.join(terms)\n         gens = list(map(self._print, poly.gens))\n         domain = \"domain=%s\" % self._print(poly.get_domain())\n \n", "test_patch": "diff --git a/sympy/printing/tests/test_latex.py b/sympy/printing/tests/test_latex.py\n--- a/sympy/printing/tests/test_latex.py\n+++ b/sympy/printing/tests/test_latex.py\n@@ -1132,11 +1132,20 @@ def test_latex_Poly():\n     assert latex(Poly(x**2 + 2 * x, x)) == \\\n         r\"\\operatorname{Poly}{\\left( x^{2} + 2 x, x, domain=\\mathbb{Z} \\right)}\"\n     assert latex(Poly(x/y, x)) == \\\n-        r\"\\operatorname{Poly}{\\left( \\frac{x}{y}, x, domain=\\mathbb{Z}\\left(y\\right) \\right)}\"\n+        r\"\\operatorname{Poly}{\\left( \\frac{1}{y} x, x, domain=\\mathbb{Z}\\left(y\\right) \\right)}\"\n     assert latex(Poly(2.0*x + y)) == \\\n         r\"\\operatorname{Poly}{\\left( 2.0 x + 1.0 y, x, y, domain=\\mathbb{R} \\right)}\"\n \n \n+def test_latex_Poly_order():\n+    assert latex(Poly([a, 1, b, 2, c, 3], x)) == \\\n+        '\\\\operatorname{Poly}{\\\\left( a x^{5} + x^{4} + b x^{3} + 2 x^{2} + c x + 3, x, domain=\\\\mathbb{Z}\\\\left[a, b, c\\\\right] \\\\right)}'\n+    assert latex(Poly([a, 1, b+c, 2, 3], x)) == \\\n+        '\\\\operatorname{Poly}{\\\\left( a x^{4} + x^{3} + \\\\left(b + c\\\\right) x^{2} + 2 x + 3, x, domain=\\\\mathbb{Z}\\\\left[a, b, c\\\\right] \\\\right)}'\n+    assert latex(Poly(a*x**3 + x**2*y - x*y - c*y**3 - b*x*y**2 + y - a*x + b, (x, y))) == \\\n+        '\\\\operatorname{Poly}{\\\\left( a x^{3} + x^{2}y -  b xy^{2} - xy -  a x -  c y^{3} + y + b, x, y, domain=\\\\mathbb{Z}\\\\left[a, b, c\\\\right] \\\\right)}'\n+\n+\n def test_latex_ComplexRootOf():\n     assert latex(rootof(x**5 + x + 3, 0)) == \\\n         r\"\\operatorname{CRootOf} {\\left(x^{5} + x + 3, 0\\right)}\"\n", "problem_statement": "LaTeX printer does not use the same order of monomials as pretty and str \nWhen printing a Poly, the str and pretty printers use the logical order of monomials, from highest to lowest degrees. But latex printer does not. \r\n```\r\n>>> var('a b c x')\r\n>>> p = Poly([a, 1, b, 2, c, 3], x)\r\n>>> p\r\nPoly(a*x**5 + x**4 + b*x**3 + 2*x**2 + c*x + 3, x, domain='ZZ[a,b,c]')\r\n>>> pretty(p)\r\n\"Poly(a*x**5 + x**4 + b*x**3 + 2*x**2 + c*x + 3, x, domain='ZZ[a,b,c]')\"\r\n>>> latex(p)\r\n'\\\\operatorname{Poly}{\\\\left( a x^{5} + b x^{3} + c x + x^{4} + 2 x^{2} + 3, x, domain=\\\\mathbb{Z}\\\\left[a, b, c\\\\right] \\\\right)}'\r\n```\n", "hints_text": "", "created_at": "2018-02-24T10:05:10Z", "version": "1.1", "FAIL_TO_PASS": "[\"test_latex_Poly\", \"test_latex_Poly_order\"]", "PASS_TO_PASS": "[\"test_printmethod\", \"test_latex_basic\", \"test_latex_builtins\", \"test_latex_SingularityFunction\", \"test_latex_cycle\", \"test_latex_permutation\", \"test_latex_Float\", \"test_latex_vector_expressions\", \"test_latex_symbols\", \"test_latex_functions\", \"test_function_subclass_different_name\", \"test_hyper_printing\", \"test_latex_bessel\", \"test_latex_fresnel\", \"test_latex_brackets\", \"test_latex_indexed\", \"test_latex_derivatives\", \"test_latex_subs\", \"test_latex_integrals\", \"test_latex_sets\", \"test_latex_SetExpr\", \"test_latex_Range\", \"test_latex_sequences\", \"test_latex_FourierSeries\", \"test_latex_FormalPowerSeries\", \"test_latex_intervals\", \"test_latex_AccumuBounds\", \"test_latex_emptyset\", \"test_latex_commutator\", \"test_latex_union\", \"test_latex_symmetric_difference\", \"test_latex_Complement\", \"test_latex_Complexes\", \"test_latex_productset\", \"test_latex_Naturals\", \"test_latex_Naturals0\", \"test_latex_Integers\", \"test_latex_ImageSet\", \"test_latex_ConditionSet\", \"test_latex_ComplexRegion\", \"test_latex_Contains\", \"test_latex_sum\", \"test_latex_product\", \"test_latex_limits\", \"test_latex_log\", \"test_issue_3568\", \"test_latex\", \"test_latex_dict\", \"test_latex_list\", \"test_latex_rational\", \"test_latex_inverse\", \"test_latex_DiracDelta\", \"test_latex_Heaviside\", \"test_latex_KroneckerDelta\", \"test_latex_LeviCivita\", \"test_mode\", \"test_latex_Piecewise\", \"test_latex_Matrix\", \"test_latex_matrix_with_functions\", \"test_latex_NDimArray\", \"test_latex_mul_symbol\", \"test_latex_issue_4381\", \"test_latex_issue_4576\", \"test_latex_pow_fraction\", \"test_noncommutative\", \"test_latex_order\", \"test_latex_Lambda\", \"test_latex_PolyElement\", \"test_latex_FracElement\", \"test_latex_ComplexRootOf\", \"test_latex_RootSum\", \"test_settings\", \"test_latex_numbers\", \"test_latex_euler\", \"test_lamda\", \"test_custom_symbol_names\", \"test_matAdd\", \"test_matMul\", \"test_latex_MatrixSlice\", \"test_latex_RandomDomain\", \"test_PrettyPoly\", \"test_integral_transforms\", \"test_PolynomialRingBase\", \"test_categories\", \"test_Modules\", \"test_QuotientRing\", \"test_Tr\", \"test_Adjoint\", \"test_Hadamard\", \"test_ZeroMatrix\", \"test_boolean_args_order\", \"test_imaginary\", \"test_builtins_without_args\", \"test_latex_greek_functions\", \"test_translate\", \"test_other_symbols\", \"test_modifiers\", \"test_greek_symbols\", \"test_builtin_no_args\", \"test_issue_6853\", \"test_Mul\", \"test_Pow\", \"test_issue_7180\", \"test_issue_8409\", \"test_issue_7117\", \"test_issue_2934\", \"test_issue_10489\", \"test_issue_12886\", \"test_issue_13651\", \"test_latex_UnevaluatedExpr\", \"test_MatrixElement_printing\", \"test_MatrixSymbol_printing\", \"test_Quaternion_latex_printing\", \"test_TensorProduct_printing\", \"test_WedgeProduct_printing\", \"test_units\"]", "environment_setup_commit": "ec9e3c0436fbff934fa84e22bf07f1b3ef5bfac3"}, "On branch master\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   sympy/printing/latex.py\n\nno changes added to commit (use \"git add\" and/or \"git commit -a\")\ncommit fb536869fb7aa28b2695ad7a3b70949926b291c4\nMerge: bdae8a86f8 61251e932b\nAuthor: Leonid Kovalev <leonidvkovalev@gmail.com>\nDate:   Thu Feb 22 18:00:59 2018 -0500\n\n    Merge pull request #14278 from sidhantnagpal/base-complex-power\n    \n    Abs of base raised to exponent for complex non-symbol bases\n\ndiff --git a/sympy/printing/latex.py b/sympy/printing/latex.py\nindex 737e16cc74..28e3f1ba53 100644\n--- a/sympy/printing/latex.py\n+++ b/sympy/printing/latex.py\n@@ -1854,7 +1854,50 @@ def _print_PolynomialRingBase(self, expr):\n \n     def _print_Poly(self, poly):\n         cls = poly.__class__.__name__\n-        expr = self._print(poly.as_expr())\n+        terms = []\n+        for monom, coeff in poly.terms():\n+            s_monom = ''\n+            for i, exp in enumerate(monom):\n+                if exp > 0:\n+                    if exp == 1:\n+                        s_monom += self._print(poly.gens[i])\n+                    else:\n+                        s_monom += self._print(pow(poly.gens[i], exp))\n+\n+            if coeff.is_Add:\n+                if s_monom:\n+                    s_coeff = r\"\\left(%s\\right)\" % self._print(coeff)\n+                else:\n+                    s_coeff = self._print(coeff)\n+            else:\n+                if s_monom:\n+                    if coeff is S.One:\n+                        terms.extend(['+', s_monom])\n+                        continue\n+\n+                    if coeff is S.NegativeOne:\n+                        terms.extend(['-', s_monom])\n+                        continue\n+\n+                s_coeff = self._print(coeff)\n+\n+            if not s_monom:\n+                s_term = s_coeff\n+            else:\n+                s_term = s_coeff + \" \" + s_monom\n+\n+            if s_term.startswith('-'):\n+                terms.extend(['-', s_term[1:]])\n+            else:\n+                terms.extend(['+', s_term])\n+\n+        if terms[0] in ['-', '+']:\n+            modifier = terms.pop(0)\n+\n+            if modifier == '-':\n+                terms[0] = '-' + terms[0]\n+\n+        expr = ' '.join(terms)\n         gens = list(map(self._print, poly.gens))\n         domain = \"domain=%s\" % self._print(poly.get_domain())\n \nObtaining file:///testbed\n  Preparing metadata (setup.py): started\n  Preparing metadata (setup.py): finished with status 'done'\nRequirement already satisfied: mpmath>=0.19 in /opt/miniconda3/envs/testbed/lib/python3.9/site-packages (from sympy==1.1.2.dev0) (1.3.0)\nInstalling collected packages: sympy\n  Attempting uninstall: sympy\n    Found existing installation: sympy 1.1.2.dev0\n    Uninstalling sympy-1.1.2.dev0:\n      Successfully uninstalled sympy-1.1.2.dev0\n  Running setup.py develop for sympy\nSuccessfully installed sympy\n============================= test process starts ==============================\nexecutable:         /opt/miniconda3/envs/testbed/bin/python  (3.9.20-final-0) [CPython]\narchitecture:       64-bit\ncache:              no\nground types:       python \nnumpy:              None\nrandom seed:        58331874\nhash randomization: off\n\nsympy/printing/tests/test_latex.py[123] \ntest_printmethod ok\ntest_latex_basic ok\ntest_latex_builtins ok\ntest_latex_SingularityFunction ok\ntest_latex_cycle ok\ntest_latex_permutation ok\ntest_latex_Float ok\ntest_latex_vector_expressions ok\ntest_latex_symbols ok\ntest_latex_symbols_failing f\ntest_latex_functions ok\ntest_function_subclass_different_name ok\ntest_hyper_printing ok\ntest_latex_bessel ok\ntest_latex_fresnel ok\ntest_latex_brackets ok\ntest_latex_indexed ok\ntest_latex_derivatives ok\ntest_latex_subs ok\ntest_latex_integrals ok\ntest_latex_sets ok\ntest_latex_SetExpr ok\ntest_latex_Range ok\ntest_latex_sequences ok\ntest_latex_FourierSeries ok\ntest_latex_FormalPowerSeries ok\ntest_latex_intervals ok\ntest_latex_AccumuBounds ok\ntest_latex_emptyset ok\ntest_latex_commutator ok\ntest_latex_union ok\ntest_latex_symmetric_difference ok\ntest_latex_Complement ok\ntest_latex_Complexes ok\ntest_latex_productset ok\ntest_latex_Naturals ok\ntest_latex_Naturals0 ok\ntest_latex_Integers ok\ntest_latex_ImageSet ok\ntest_latex_ConditionSet ok\ntest_latex_ComplexRegion ok\ntest_latex_Contains ok\ntest_latex_sum ok\ntest_latex_product ok\ntest_latex_limits ok\ntest_latex_log ok\ntest_issue_3568 ok\ntest_latex ok\ntest_latex_dict ok\ntest_latex_list ok\ntest_latex_rational ok\ntest_latex_inverse ok\ntest_latex_DiracDelta ok\ntest_latex_Heaviside ok\ntest_latex_KroneckerDelta ok\ntest_latex_LeviCivita ok\ntest_mode ok\ntest_latex_Piecewise ok\ntest_latex_Matrix ok\ntest_latex_matrix_with_functions ok\ntest_latex_NDimArray ok\ntest_latex_mul_symbol ok\ntest_latex_issue_4381 ok\ntest_latex_issue_4576 ok\ntest_latex_pow_fraction ok\ntest_noncommutative ok\ntest_latex_order ok\ntest_latex_Lambda ok\ntest_latex_PolyElement ok\ntest_latex_FracElement ok\ntest_latex_Poly ok\ntest_latex_Poly_order ok\ntest_latex_ComplexRootOf ok\ntest_latex_RootSum ok\ntest_settings ok\ntest_latex_numbers ok\ntest_latex_euler ok\ntest_lamda ok\ntest_custom_symbol_names ok\ntest_matAdd ok\ntest_matMul ok\ntest_latex_MatrixSlice ok\ntest_latex_RandomDomain ok\ntest_PrettyPoly ok\ntest_integral_transforms ok\ntest_PolynomialRingBase ok\ntest_categories ok\ntest_Modules ok\ntest_QuotientRing ok\ntest_Tr ok\ntest_Adjoint ok\ntest_Hadamard ok\ntest_ZeroMatrix ok\ntest_boolean_args_order ok\ntest_imaginary ok\ntest_builtins_without_args ok\ntest_latex_greek_functions ok\ntest_translate ok\ntest_other_symbols ok\ntest_modifiers ok\ntest_greek_symbols ok\ntest_builtin_without_args_mismatched_names f\ntest_builtin_no_args ok\ntest_issue_6853 ok\ntest_Mul ok\ntest_Pow ok\ntest_issue_7180 ok\ntest_issue_8409 ok\ntest_issue_8470 E\ntest_issue_7117 ok\ntest_issue_2934 ok\ntest_issue_10489 ok\ntest_issue_12886 ok\ntest_issue_13559 E\ntest_issue_13651 ok\ntest_latex_UnevaluatedExpr ok\ntest_MatrixElement_printing ok\ntest_MatrixSymbol_printing ok\ntest_Quaternion_latex_printing ok\ntest_TensorProduct_printing ok\ntest_WedgeProduct_printing ok\ntest_units ok\ntest_latex_degree ok                                                      [FAIL]\n\n\n________________________________________________________________________________\n______________ sympy/printing/tests/test_latex.py:test_issue_8470 ______________\n  File \"/testbed/sympy/printing/tests/test_latex.py\", line 1661, in test_issue_8470\n    e = parse_expr(\"-B*A\", evaluate=False)\n  File \"/testbed/sympy/parsing/sympy_parser.py\", line 948, in parse_expr\n    code = compile(evaluateFalse(code), '<string>', 'eval')\nValueError: Name node can't be used with 'False' constant\n________________________________________________________________________________\n_____________ sympy/printing/tests/test_latex.py:test_issue_13559 ______________\n  File \"/testbed/sympy/printing/tests/test_latex.py\", line 1694, in test_issue_13559\n    expr = parse_expr('5/1', evaluate=False)\n  File \"/testbed/sympy/parsing/sympy_parser.py\", line 948, in parse_expr\n    code = compile(evaluateFalse(code), '<string>', 'eval')\nValueError: Name node can't be used with 'False' constant\n\n tests finished: 119 passed, 2 expected to fail, 2 exceptions, in 2.35 seconds =\nDO *NOT* COMMIT!\n", {"sympy/printing/tests/test_latex.py:test_issue_8470": "FAILED", "sympy/printing/tests/test_latex.py:test_issue_13559": "FAILED", "test_printmethod": "PASSED", "test_latex_basic": "PASSED", "test_latex_builtins": "PASSED", "test_latex_SingularityFunction": "PASSED", "test_latex_cycle": "PASSED", "test_latex_permutation": "PASSED", "test_latex_Float": "PASSED", "test_latex_vector_expressions": "PASSED", "test_latex_symbols": "PASSED", "test_latex_functions": "PASSED", "test_function_subclass_different_name": "PASSED", "test_hyper_printing": "PASSED", "test_latex_bessel": "PASSED", "test_latex_fresnel": "PASSED", "test_latex_brackets": "PASSED", "test_latex_indexed": "PASSED", "test_latex_derivatives": "PASSED", "test_latex_subs": "PASSED", "test_latex_integrals": "PASSED", "test_latex_sets": "PASSED", "test_latex_SetExpr": "PASSED", "test_latex_Range": "PASSED", "test_latex_sequences": "PASSED", "test_latex_FourierSeries": "PASSED", "test_latex_FormalPowerSeries": "PASSED", "test_latex_intervals": "PASSED", "test_latex_AccumuBounds": "PASSED", "test_latex_emptyset": "PASSED", "test_latex_commutator": "PASSED", "test_latex_union": "PASSED", "test_latex_symmetric_difference": "PASSED", "test_latex_Complement": "PASSED", "test_latex_Complexes": "PASSED", "test_latex_productset": "PASSED", "test_latex_Naturals": "PASSED", "test_latex_Naturals0": "PASSED", "test_latex_Integers": "PASSED", "test_latex_ImageSet": "PASSED", "test_latex_ConditionSet": "PASSED", "test_latex_ComplexRegion": "PASSED", "test_latex_Contains": "PASSED", "test_latex_sum": "PASSED", "test_latex_product": "PASSED", "test_latex_limits": "PASSED", "test_latex_log": "PASSED", "test_issue_3568": "PASSED", "test_latex": "PASSED", "test_latex_dict": "PASSED", "test_latex_list": "PASSED", "test_latex_rational": "PASSED", "test_latex_inverse": "PASSED", "test_latex_DiracDelta": "PASSED", "test_latex_Heaviside": "PASSED", "test_latex_KroneckerDelta": "PASSED", "test_latex_LeviCivita": "PASSED", "test_mode": "PASSED", "test_latex_Piecewise": "PASSED", "test_latex_Matrix": "PASSED", "test_latex_matrix_with_functions": "PASSED", "test_latex_NDimArray": "PASSED", "test_latex_mul_symbol": "PASSED", "test_latex_issue_4381": "PASSED", "test_latex_issue_4576": "PASSED", "test_latex_pow_fraction": "PASSED", "test_noncommutative": "PASSED", "test_latex_order": "PASSED", "test_latex_Lambda": "PASSED", "test_latex_PolyElement": "PASSED", "test_latex_FracElement": "PASSED", "test_latex_Poly": "PASSED", "test_latex_Poly_order": "PASSED", "test_latex_ComplexRootOf": "PASSED", "test_latex_RootSum": "PASSED", "test_settings": "PASSED", "test_latex_numbers": "PASSED", "test_latex_euler": "PASSED", "test_lamda": "PASSED", "test_custom_symbol_names": "PASSED", "test_matAdd": "PASSED", "test_matMul": "PASSED", "test_latex_MatrixSlice": "PASSED", "test_latex_RandomDomain": "PASSED", "test_PrettyPoly": "PASSED", "test_integral_transforms": "PASSED", "test_PolynomialRingBase": "PASSED", "test_categories": "PASSED", "test_Modules": "PASSED", "test_QuotientRing": "PASSED", "test_Tr": "PASSED", "test_Adjoint": "PASSED", "test_Hadamard": "PASSED", "test_ZeroMatrix": "PASSED", "test_boolean_args_order": "PASSED", "test_imaginary": "PASSED", "test_builtins_without_args": "PASSED", "test_latex_greek_functions": "PASSED", "test_translate": "PASSED", "test_other_symbols": "PASSED", "test_modifiers": "PASSED", "test_greek_symbols": "PASSED", "test_builtin_no_args": "PASSED", "test_issue_6853": "PASSED", "test_Mul": "PASSED", "test_Pow": "PASSED", "test_issue_7180": "PASSED", "test_issue_8409": "PASSED", "test_issue_8470": "ERROR", "test_issue_7117": "PASSED", "test_issue_2934": "PASSED", "test_issue_10489": "PASSED", "test_issue_12886": "PASSED", "test_issue_13559": "ERROR", "test_issue_13651": "PASSED", "test_latex_UnevaluatedExpr": "PASSED", "test_MatrixElement_printing": "PASSED", "test_MatrixSymbol_printing": "PASSED", "test_Quaternion_latex_printing": "PASSED", "test_TensorProduct_printing": "PASSED", "test_WedgeProduct_printing": "PASSED", "test_units": "PASSED"}]